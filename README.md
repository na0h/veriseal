# VeriSeal

VeriSeal は「検証可能なデータ（Verifiable Data）」を扱うための最小ツールキットです。

サーバーやエッジを信頼せず、
**最終的な正しさの判断をクライアントが行う** ことを前提とします。

このリポジトリはまず CLI を基準実装とし、
署名・検証・正規化の挙動を固定することを目的とします。

---

## 目的（Goals）

* データが改ざんされていないことを、クライアント自身が検証できる状態を作る
* 以下を決定論的に行える最小実装を提供する

  * JSON の正規化（canonicalization）
  * 署名
  * 検証
* 将来 API / Web / SDK を作っても挙動がブレない参照実装を作る

---

## やらないこと（Non-goals）

以下は意図的にやらない。

* サーバーを「正しさの源泉」にしない
  （サーバーは保存・配布のみ）
* core に I/O、CLI、ファイル操作、時刻取得を入れない
* 鍵管理・PKI・鍵配布基盤を作らない
* ブロックチェーンや台帳を扱わない
* 複数署名方式を同時にサポートしない
  （初期は Ed25519 のみ）

---

## 設計方針

### core と client を分離する

* **core**

  * 署名・検証・正規化の純粋ロジック
  * 同じ入力に対して同じ出力を返す
  * 環境依存コードを持たない

* **client**

  * CLI（最初の参照実装）
  * 引数処理、stdin/stdout、鍵ファイル読み込み
  * 運用ポリシーの判断

CLI は便利ツールではなく、
VeriSeal の挙動を定義する基準実装とする。

---

## リポジトリ構成（最小）

```
veriseal/
  cmd/
    veriseal/        # CLI（client）
  core/              # 署名・検証の中核
  canonical/         # JSON 正規化
  crypto/            # 暗号プリミティブ（Ed25519）
  testdata/
    vectors/         # テストベクタ（互換性の基準）
```

---

## データモデル（Envelope v0 / draft）

```json
{
  "v": 0,
  "alg": "Ed25519",
  "kid": "demo-1",
  "payload": { "example": 123 },
  "sig": "BASE64..."
}
```

### 署名ルール

* `sig` を除いた Envelope を canonicalize した bytes を署名対象とする
* 検証時も同じ手順を再現できなければならない

---

## CLI

* `veriseal canon`
  JSON を canonical bytes に変換する

* `veriseal sign --privkey <path>`
  Envelope を署名し `sig` を付与する

* `veriseal verify --pubkey <path>`
  署名を検証し結果を出力する

鍵解決はファイル指定のみとし、高度な仕組みは後回しとする。

---

## 互換性ポリシー

* canonical の挙動は最重要の互換境界とする
* 既存のテストベクタは「draft の杭」として保持する（変更する場合は意図的に更新する）
* 破壊的変更（draft段階の仕様変更）を行う場合は：

  * 変更理由を残す（例: docs/adr/ に1行）
  * テストベクタを意図的に更新する（無自覚に壊さない）
  * 可能なら将来の v1 で確定する

---

## セキュリティ前提

* サーバーは攻撃されうる
* 通信経路は信用しない
* クライアント検証を省略してはならない
